<?xml version="1.0" encoding="UTF-8"?>
<!-- 
// Cycle Monitor, Copyright (C) 2015  M.B.Grieve
// This file is part of the Cycle Monitor example application.
//
// Cycle Monitor is free software: you can redistribute it and/or modify
// it under the terms of the GNU General Public License as published by
// the Free Software Foundation, either version 3 of the License, or
// (at your option) any later version.

// Cycle Monitor is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU General Public License for more details.

// You should have received a copy of the GNU General Public License
// along with City Monitor.  If not, see <http://www.gnu.org/licenses/>.
//
// Contact: moray.grieve@me.com
-->

<adapter-config xmlns:xi="http://www.w3.org/2001/XInclude">
	<java>
		<classpath path="${basedir}/java/lib/cron4j-2.2.5.jar" />
		<classpath path="${basedir}/java/lib/json-simple-1.1.jar" />
	</java>

	<transports>
		<transport name="CityBikesTransport" jarName="${basedir}/java/lib/city-bikes-adapter.jar"
			className="com.jtech.iaf.CityBikesTransport">
			<property name="cityName" value="${city-name}" />
			<property name="dataURL" value="${data-url}" />
			<property name="pollingSchedule" value="${polling-schedule}" />
		</transport>
	</transports>

	<codecs>
		<codec name="JNullCodec" jarName="${apama.home}/adapters/lib/JNullCodec.jar"
			className="com.apama.iaf.codec.nullcodec.JNullCodec" />
	</codecs>

	<mapping>
		<event name="Start" package="com.jtech.source" direction="upstream"
			inject="false" encoder="JNullCodec">
			<id-rules>
				<upstream />
			</id-rules>
			<mapping-rules>
				<map transport="__type" type="string" default="Start" />
			</mapping-rules>
		</event>
		<event name="Stop" package="com.jtech.source" direction="upstream"
			inject="false" encoder="JNullCodec">
			<id-rules>
				<upstream />
			</id-rules>
			<mapping-rules>
				<map transport="__type" type="string" default="Stop" />
			</mapping-rules>
		</event>
		<event name="Poll" package="com.jtech.source" direction="upstream"
			inject="false" encoder="JNullCodec">
			<id-rules>
				<upstream />
			</id-rules>
			<mapping-rules>
				<map transport="__type" type="string" default="Poll" />
			</mapping-rules>
		</event>
		<event name="StationUpdate" package="com.jtech.source"
			direction="downstream" inject="false" encoder="JNullCodec">
			<id-rules>
				<downstream>
					<id fields="__type" test="==" value="__station_update" />
				</downstream>
			</id-rules>
			<mapping-rules>
				<map apama="city" transport="city" type="string" default="" />
				<map apama="id" transport="id" type="integer" default="0" />
				<map apama="name" transport="name" type="string" default="" />
				<map apama="lat" transport="lat" type="float" default="0.0" />
				<map apama="lng" transport="lng" type="float" default="0.0" />
				<map apama="ratio" transport="ratio" type="float" default="0.0" />
				<map apama="docked" transport="docked" type="integer" default="0" />
				<map apama="empty" transport="empty" type="integer" default="0" />
				<map apama="active" transport="active" type="boolean" default="false" />
				<map apama="timestamp" transport="timestamp" type="float"
					default="0.0" />
			</mapping-rules>
		</event>
	</mapping>

	<apama>
		<sinks>
			<sink host="localhost" port="${correlator.port}" />
		</sinks>
		<sources>
			<source host="localhost" port="${correlator.port}" channels="CITY-BIKES" />
		</sources>
	</apama>

</adapter-config>
