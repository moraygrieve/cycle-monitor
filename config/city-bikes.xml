<?xml version="1.0" encoding="UTF-8"?>

<adapter-config xmlns:xi="http://www.w3.org/2001/XInclude">
	<java>
		<classpath path="./java/lib/cron4j-2.2.5.jar" />
		<classpath path="./java/lib/json-simple-1.1.jar" />
	</java>

	<transports>
		<transport name="CityBikesTransport" jarName="./java/lib/city-bikes-adapter.jar"
			className="com.jtech.iaf.CityBikesTransport">
			<property name="cityName" value="${city-name}" />
			<property name="dataURL" value="${data-url}" />
			<property name="pollingSchedule" value="${polling-schedule}" />
		</transport>
	</transports>

	<codecs>
		<codec name="JNullCodec" jarName="${apama.home}/adapters/lib/JNullCodec.jar"
			className="com.apama.iaf.codec.nullcodec.JNullCodec" />
	</codecs>

	<mapping>
		<event name="Start" package="com.jtech.source" direction="upstream"
			inject="false" encoder="JNullCodec">
			<id-rules>
				<upstream />
			</id-rules>
			<mapping-rules>
				<map transport="__type" type="string" default="Start" />
			</mapping-rules>
		</event>

		<event name="StationUpdate" package="com.jtech.source"
			direction="downstream" inject="false" encoder="JNullCodec">
			<id-rules>
				<downstream>
					<id fields="__type" test="==" value="__station_update" />
				</downstream>
			</id-rules>
			<mapping-rules>
				<map apama="city" transport="city" type="string" default="" />
				<map apama="id" transport="id" type="integer" default="0" />
				<map apama="name" transport="name" type="string" default="" />
				<map apama="lat" transport="lat" type="float" default="0" />
				<map apama="lng" transport="lng" type="float" default="0" />
				<map apama="docked" transport="docked" type="integer" default="0" />
				<map apama="empty" transport="empty" type="integer" default="0" />
				<map apama="active" transport="active" type="boolean" default="false" />
			</mapping-rules>
		</event>
	</mapping>

	<apama>
		<sinks>
			<sink host="localhost" port="${correlator.port}" />
		</sinks>
		<sources>
			<source host="localhost" port="${correlator.port}" channels="CITY-BIKES" />
		</sources>
	</apama>

</adapter-config>
